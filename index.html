<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grok Chat Productivity Assistant</title>
    <style>
        body{background-color:#f3f4f6;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:1rem;font-family:Arial,sans-serif}.container{background-color:#fff;border-radius:0.5rem;box-shadow:0 4px 6px rgba(0,0,0,0.1);padding:1.5rem;width:100%;max-width:28rem}.title{font-size:1.5rem;font-weight:700;text-align:center;margin-bottom:1rem}.input-container{margin-bottom:1rem}.input-field{width:100%;padding:0.5rem;border:1px solid #d1d5db;border-radius:0.25rem}.response-container{margin-bottom:1rem;padding:1rem;background-color:#f9fafb;border:1px solid #d1d5db;border-radius:0.25rem;min-height:100px;overflow-y:auto}.task-list-container{margin-bottom:1rem}.task-list-title{font-size:1.125rem;font-weight:600}.task-list{list-style-type:disc;padding-left:1.25rem}.task-item{display:flex;align-items:center}.delete-button{margin-left:0.5rem;color:#ef4444;font-size:0.875rem}.footer-text{font-size:0.875rem;color:#4b5563;text-align:center}.error-text{color:#dc2626;font-size:0.875rem;margin-top:0.5rem}.api-key-container{margin-bottom:1rem}.api-key-button{background-color:#3b82f6;color:#fff;padding:0.5rem 1rem;border-radius:0.25rem;margin-top:0.5rem}.api-key-button:hover{background-color:#2563eb}.loading{display:none;color:#4b5563;font-size:0.875rem;margin-top:0.5rem}
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Grok Chat Productivity Assistant</h1>
        <div class="api-key-container">
            <input id="apiKeyInput" type="text" placeholder="Enter your xAI API key" class="input-field">
            <button id="saveApiKey" class="api-key-button">Save API Key</button>
            <p id="apiKeyError" class="error-text" style="display:none;"></p>
        </div>
        <div class="input-container">
            <input id="textInput" type="text" placeholder="Type your command (e.g., 'Add task Buy groceries' or 'What's 2+2?')" class="input-field">
            <p id="inputError" class="error-text" style="display:none;">Please enter a command.</p>
            <p id="loading" class="loading">Loading...</p>
        </div>
        <div id="response" class="response-container"></div>
        <div id="taskList" class="task-list-container">
            <h2 class="task-list-title">Tasks</h2>
            <ul id="tasks" class="task-list"></ul>
        </div>
        <p class="footer-text">Powered by xAI Grok. <a href="https://console.x.ai/team/default/api-keys" target="_blank">Get your API key</a>.</p>
    </div>

    <script>
        // DOM Elements
        const apiKeyInput = document.getElementById('apiKeyInput');
        const saveApiKeyBtn = document.getElementById('saveApiKey');
        const apiKeyError = document.getElementById('apiKeyError');
        const textInput = document.getElementById('textInput');
        const inputError = document.getElementById('inputError');
        const loading = document.getElementById('loading');
        const responseDiv = document.getElementById('response');
        const taskList = document.getElementById('tasks');

        // Store API key in memory
        let apiKey = '';

        // Task storage
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];

        // Update task list UI
        function updateTaskList() {
            taskList.innerHTML = '';
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.textContent = task;
                li.className = 'task-item';
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'delete-button';
                deleteBtn.onclick = () => {
                    tasks.splice(index, 1);
                    localStorage.setItem('tasks', JSON.stringify(tasks));
                    updateTaskList();
                };
                li.appendChild(deleteBtn);
                taskList.appendChild(li);
            });
        }

        // Validate API key
        async function validateApiKey(key) {
            try {
                const response = await fetch('https://api.grok.xai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-beta',
                        messages: [{ role: 'user', content: 'Test' }],
                        max_tokens: 10
                    })
                });
                if (!response.ok) {
                    if (response.status === 401) throw new Error('Invalid API key. Please check your key at https://console.x.ai/team/default/api-keys.');
                    if (response.status === 429) throw new Error('Rate limit exceeded. Try again later.');
                    throw new Error(`API request failed: ${response.statusText}`);
                }
                return true;
            } catch (error) {
                throw error;
            }
        }

        // Save API key
        saveApiKeyBtn.addEventListener('click', async () => {
            const key = apiKeyInput.value.trim();
            if (!key) {
                apiKeyError.textContent = 'Please enter an API key.';
                apiKeyError.style.display = 'block';
                return;
            }
            try {
                apiKeyError.style.display = 'none';
                loading.style.display = 'block';
                await validateApiKey(key);
                apiKey = key;
                responseDiv.textContent = 'API key saved successfully! Try a command like "Add task Buy groceries" or "Whatâ€™s 2+2?"';
                apiKeyInput.value = '';
            } catch (error) {
                apiKeyError.textContent = `Error: ${error.message}`;
                apiKeyError.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        });

        // Call xAI Grok API
        async function callGrokAPI(input) {
            try {
                // Handle task management locally
                if (input.toLowerCase().startsWith('add task')) {
                    const task = input.replace(/add task/i, '').trim();
                    if (task) {
                        tasks.push(task);
                        localStorage.setItem('tasks', JSON.stringify(tasks));
                        updateTaskList();
                        return `Task "${task}" added.`;
                    }
                    return 'Please specify a task to add.';
                } else if (input.toLowerCase().startsWith('set reminder')) {
                    const reminder = input.replace(/set reminder/i, '').trim();
                    return reminder ? `Reminder set for "${reminder}". (Notifications not implemented.)` : 'Please specify a reminder.';
                }

                // Check for API key
                if (!apiKey) {
                    return 'Please enter a valid xAI API key above to use Grok for general queries. Task and reminder commands work without a key.';
                }

                // Show loading
                loading.style.display = 'block';

                // Send query to Grok API
                const response = await fetch('https://api.grok.xai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-beta',
                        messages: [{ role: 'user', content: input }],
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    if (response.status === 401) throw new Error('Invalid API key. Please check your key at https://console.x.ai/team/default/api-keys.');
                    if (response.status === 429) throw new Error('Rate limit exceeded. Try again later.');
                    throw new Error(`API request failed: ${response.statusText}`);
                }

                const data = await response.json();
                if (!data.choices || !data.choices[0].message.content) {
                    throw new Error('Invalid API response. Please try again.');
                }

                return data.choices[0].message.content.trim();
            } catch (error) {
                // Fallback mock responses for general queries
                const lowerInput = input.toLowerCase();
                if (lowerInput.includes('capital of france')) {
                    return 'The capital of France is Paris. (Using mock response due to API error: ' + error.message + ')';
                } else if (lowerInput.includes('weather')) {
                    return 'I cannot check real-time weather without a valid API key. Try asking something else. (Error: ' + error.message + ')';
                } else if (lowerInput.includes('2+2')) {
                    return '2 + 2 equals 4. (Using mock response due to API error: ' + error.message + ')';
                }
                return `Error: ${error.message}. You can still use "Add task" or "Set reminder" commands.`;
            } finally {
                loading.style.display = 'none';
            }
        }

        // Handle text input
        textInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter' && textInput.value.trim()) {
                inputError.style.display = 'none';
                const input = textInput.value.trim();
                responseDiv.textContent = `You: ${input}`;
                loading.style.display = 'block';
                const grokResponse = await callGrokAPI(input);
                responseDiv.textContent += `\nGrok: ${grokResponse}`;
                responseDiv.scrollTop = responseDiv.scrollHeight;
                textInput.value = '';
            } else if (e.key === 'Enter') {
                inputError.style.display = 'block';
            }
        });

        // Initial task list render
        updateTaskList();
    </script>
</body>
</html>
